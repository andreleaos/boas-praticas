
Api Gateway

â˜ï¸ O que Ã© o API Gateway?

- ServiÃ§o gerenciado da AWS que permite criar, publicar, monitorar e proteger APIs em escala.
- Faz interface entre clientes (ex.: frontends, apps) e backends serverless (como Lambda), serviÃ§os HTTP ou qualquer recurso na AWS.

Suporte a:

- âœ… REST APIs
 -âœ… HTTP APIs (mais simples e performÃ¡tica)
- âœ… WebSocket APIs

ğŸ¯ CenÃ¡rio PrÃ¡tico â€” API REST Serverless de Clientes

| MÃ©todo | Endpoint         | AÃ§Ã£o                     | Lambda associada      |
| ------ | ---------------- | ------------------------ | --------------------- |
| POST   | `/clientes`      | Criar cliente            | `CreateClienteLambda` |
| GET    | `/clientes/{id}` | Buscar cliente por ID    | `GetClienteLambda`    |
| GET    | `/clientes`      | Listar todos os clientes | `ListClientesLambda`  |
| PUT    | `/clientes/{id}` | Atualizar cliente        | `UpdateClienteLambda` |
| DELETE | `/clientes/{id}` | Deletar cliente          | `DeleteClienteLambda` |

ğŸ”§ ConfiguraÃ§Ã£o do API Gateway com Lambda â€” Conceito

âœ”ï¸ Funcionamento:

- O API Gateway recebe a requisiÃ§Ã£o HTTP.
- Encaminha o evento para a funÃ§Ã£o Lambda correspondente.
- Lambda processa a lÃ³gica.
- API Gateway retorna a resposta HTTP para o cliente.

ğŸ”¥ ConfiguraÃ§Ã£o Manual no Console da AWS (Passo a Passo)

- âœ”ï¸ 1. Crie as FunÃ§Ãµes Lambda:
- Uma Lambda para cada operaÃ§Ã£o CRUD (Create, Read, Update, Delete).

âœ”ï¸ 2. Crie a API no API Gateway:

- Tipo: REST API (se quiser suporte completo de transformaÃ§Ã£o de payload) ou HTTP API (mais leve e performÃ¡tica).
- Endpoint: /clientes

âœ”ï¸ 3. Configure os MÃ©todos:

| RequisiÃ§Ã£o HTTP | Endpoint         | AÃ§Ã£o                         |
| --------------- | ---------------- | ---------------------------- |
| **POST**        | `/clientes`      | Invoca `CreateClienteLambda` |
| **GET**         | `/clientes/{id}` | Invoca `GetClienteLambda`    |
| **GET**         | `/clientes`      | Invoca `ListClientesLambda`  |
| **PUT**         | `/clientes/{id}` | Invoca `UpdateClienteLambda` |
| **DELETE**      | `/clientes/{id}` | Invoca `DeleteClienteLambda` |

âœ”ï¸ 4. IntegraÃ§Ã£o:

- Tipo: Lambda Function
- Escolha a funÃ§Ã£o Lambda correspondente.
- Marque para usar Proxy Integration (Lambda Proxy) â†’ envia o evento completo em formato JSON para a Lambda.

âœ”ï¸ 5. Deployment:

- Crie um estÃ¡gio, exemplo: dev.
- Publique a API (Actions > Deploy API).

ğŸ“œ Formato do Evento JSON recebido pela Lambda via API Gateway Proxy

{
  "resource": "/clientes/{id}",
  "path": "/clientes/123",
  "httpMethod": "GET",
  "headers": { ... },
  "queryStringParameters": null,
  "pathParameters": { "id": "123" },
  "body": null,
  "isBase64Encoded": false
}

ğŸ—ï¸ Exemplo de Lambda â€” GetClienteLambda

package br.com.lambda;

import com.amazonaws.services.lambda.runtime.Context;
import com.amazonaws.services.lambda.runtime.RequestHandler;

import java.util.Map;

public class GetClienteLambda implements RequestHandler<Map<String, Object>, ApiGatewayResponse> {

    @Override
    public ApiGatewayResponse handleRequest(Map<String, Object> input, Context context) {
        Map<String, String> pathParameters = (Map<String, String>) input.get("pathParameters");
        String id = pathParameters.get("id");

        context.getLogger().log("Buscando cliente com ID: " + id);

        String responseBody = "{ \"id\": \"" + id + "\", \"nome\": \"AndrÃ© LeÃ£o\", \"email\": \"andre@email.com\" }";

        return ApiGatewayResponse.builder()
                .setStatusCode(200)
                .setObjectBody(responseBody)
                .build();
    }
}

âœ”ï¸ Com um helper para Response:

package br.com.lambda;

import java.util.Collections;
import java.util.Map;

public class ApiGatewayResponse {
    private final int statusCode;
    private final String body;

    private ApiGatewayResponse(int statusCode, String body) {
        this.statusCode = statusCode;
        this.body = body;
    }

    public int getStatusCode() { return statusCode; }
    public String getBody() { return body; }

    public static Builder builder() {
        return new Builder();
    }

    public static class Builder {
        private int statusCode;
        private String body;

        public Builder setStatusCode(int statusCode) {
            this.statusCode = statusCode;
            return this;
        }

        public Builder setObjectBody(String body) {
            this.body = body;
            return this;
        }

        public ApiGatewayResponse build() {
            return new ApiGatewayResponse(statusCode, body);
        }
    }
}

---

ğŸš€ Infraestrutura como CÃ³digo â€” Exemplo com Terraform

resource "aws_api_gateway_rest_api" "clientes_api" {
  name = "ClientesAPI"
}

resource "aws_api_gateway_resource" "clientes" {
  rest_api_id = aws_api_gateway_rest_api.clientes_api.id
  parent_id   = aws_api_gateway_rest_api.clientes_api.root_resource_id
  path_part   = "clientes"
}

resource "aws_api_gateway_method" "post_clientes" {
  rest_api_id   = aws_api_gateway_rest_api.clientes_api.id
  resource_id   = aws_api_gateway_resource.clientes.id
  http_method   = "POST"
  authorization = "NONE"
}

resource "aws_api_gateway_integration" "post_clientes" {
  rest_api_id = aws_api_gateway_rest_api.clientes_api.id
  resource_id = aws_api_gateway_resource.clientes.id
  http_method = aws_api_gateway_method.post_clientes.http_method

  integration_http_method = "POST"
  type                    = "AWS_PROXY"
  uri                     = aws_lambda_function.create_cliente.invoke_arn
}

âœ”ï¸ Este exemplo configura a rota /clientes para o mÃ©todo POST e integra com uma Lambda chamada create_cliente.

---

ğŸ”¥ Resumo Visual â€” Arquitetura

(Client) â†’ API Gateway  â†’ Lambda (CreateCliente)
                        â†’ Lambda (GetCliente)
                        â†’ Lambda (ListClientes)
                        â†’ Lambda (UpdateCliente)
                        â†’ Lambda (DeleteCliente)

----

ğŸ† Boas PrÃ¡ticas com API Gateway + Lambda

| Boas PrÃ¡ticas              | âœ”ï¸ RecomendaÃ§Ã£o                                     |
| -------------------------- | --------------------------------------------------- |
| Mapeamento de erros        | Configure modelos de resposta para erros HTTP       |
| SeguranÃ§a                  | Use Auth (IAM, Lambda Authorizer ou Cognito)        |
| Rate limiting / Throttling | Configure limites de chamadas                       |
| Logging                    | API Gateway + Lambda envia logs para CloudWatch     |
| Deploy                     | Use Terraform, AWS SAM, CDK ou Serverless Framework |


