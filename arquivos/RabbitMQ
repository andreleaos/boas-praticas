
RabbitMQ

RabbitMQ com Java, abordando os conceitos principais e construindo um exemplo de Producer (Produtor) e Consumer (Consumidor).

 ğŸ›ï¸ O que Ã© RabbitMQ?

âœ”ï¸ RabbitMQ Ã© um sistema de mensageria baseado no protocolo AMQP (Advanced Message Queuing Protocol).
âœ”ï¸ Ã‰ um message broker â€” ele recebe, armazena e entrega mensagens entre aplicaÃ§Ãµes de forma assÃ­ncrona.
âœ”ï¸ Ã‰ fundamental em arquiteturas event-driven (orientada a eventos), microservices e sistemas desacoplados.

---

ğŸ”¥ Conceitos Fundamentais do RabbitMQ

| Conceito        | DescriÃ§Ã£o                                                      |
| --------------- | -------------------------------------------------------------- |
| **Producer**    | Envia mensagens para o RabbitMQ.                               |
| **Queue**       | Fila que armazena mensagens.                                   |
| **Exchange**    | Roteia as mensagens para uma ou mais filas.                    |
| **Routing Key** | Chave de roteamento usada pelo exchange para enviar mensagens. |
| **Consumer**    | LÃª e processa mensagens das filas.                             |
| **Binding**     | RelaÃ§Ã£o entre Exchange e Queue com base na routing key.        |

ğŸš€ Arquitetura BÃ¡sica â€” RabbitMQ

Producer â†’ Exchange â†’ Queue â†’ Consumer

ğŸ¯ Tipos de Exchange

| Tipo        | DescriÃ§Ã£o                                                  |
| ----------- | ---------------------------------------------------------- |
| **direct**  | Roteia com base na routing key exata.                      |
| **fanout**  | Ignora routing key e envia para todas as filas vinculadas. |
| **topic**   | Usa padrÃµes (ex.: `log.*`) para roteamento flexÃ­vel.       |
| **headers** | Roteamento baseado nos headers das mensagens.              |


ğŸ—ï¸ Exemplo PrÃ¡tico â€” Producer e Consumer com RabbitMQ em Java

ğŸ”§ DependÃªncia Maven

<dependency>
    <groupId>com.rabbitmq</groupId>
    <artifactId>amqp-client</artifactId>
    <version>5.19.0</version>
</dependency>


âœ… ConfiguraÃ§Ã£o do RabbitMQ

âœ”ï¸ Supondo que o RabbitMQ estÃ¡ rodando em:

- localhost
- Porta padrÃ£o: 5672
- UsuÃ¡rio: guest
- Senha: guest

ğŸ”¸ Producer â€” Enviar Mensagens

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;

public class Producer {

    private static final String QUEUE_NAME = "fila_clientes";

    public static void main(String[] args) throws Exception {
        // Cria conexÃ£o com RabbitMQ
        ConnectionFactory factory = new ConnectionFactory();
        factory.setHost("localhost");
        factory.setUsername("guest");
        factory.setPassword("guest");

        try (Connection connection = factory.newConnection();
             Channel channel = connection.createChannel()) {

            // Declara a fila
            channel.queueDeclare(QUEUE_NAME, true, false, false, null);

            String mensagem = "Cadastro de cliente: AndrÃ© LeÃ£o";

            // Envia a mensagem para a fila
            channel.basicPublish("", QUEUE_NAME, null, mensagem.getBytes());

            System.out.println("ğŸš€ Mensagem enviada: " + mensagem);
        }
    }
}

---

ğŸ”¸ Consumer â€” Consumir Mensagens

import com.rabbitmq.client.*;

import java.io.IOException;

public class Consumer {

    private static final String QUEUE_NAME = "fila_clientes";

    public static void main(String[] args) throws Exception {
        // Cria conexÃ£o com RabbitMQ
        ConnectionFactory factory = new ConnectionFactory();
        factory.setHost("localhost");
        factory.setUsername("guest");
        factory.setPassword("guest");

        Connection connection = factory.newConnection();
        Channel channel = connection.createChannel();

        // Declara a fila (garantia que existe)
        channel.queueDeclare(QUEUE_NAME, true, false, false, null);

        System.out.println("ğŸ•‘ Aguardando mensagens...");

        DeliverCallback deliverCallback = (consumerTag, delivery) -> {
            String mensagem = new String(delivery.getBody(), "UTF-8");
            System.out.println("ğŸ“¥ Mensagem recebida: " + mensagem);
        };

        channel.basicConsume(QUEUE_NAME, true, deliverCallback, consumerTag -> {});
    }
}

âœ”ï¸ SaÃ­da Esperada

Producer:
ğŸš€ Mensagem enviada: Cadastro de cliente: AndrÃ© LeÃ£o

Consumer:
ğŸ•‘ Aguardando mensagens...
ğŸ“¥ Mensagem recebida: Cadastro de cliente: AndrÃ© LeÃ£o

ğŸ”¥ Funcionamento

- O Producer conecta ao RabbitMQ e envia uma mensagem para a fila fila_clientes.
- O Consumer escuta essa fila e processa as mensagens que chegam.

ğŸ—ï¸ Arquitetura com Exchange (Roteamento mais avanÃ§ado)

ğŸ”¥ Exemplo com direct exchange:

âœ… Producer:

channel.exchangeDeclare("clientes_exchange", "direct");
channel.queueDeclare("fila_cadastro", true, false, false, null);
channel.queueBind("fila_cadastro", "clientes_exchange", "cadastro");

String mensagem = "Novo cliente cadastrado: AndrÃ©";
channel.basicPublish("clientes_exchange", "cadastro", null, mensagem.getBytes());

âœ… Consumer:

channel.exchangeDeclare("clientes_exchange", "direct");
channel.queueDeclare("fila_cadastro", true, false, false, null);
channel.queueBind("fila_cadastro", "clientes_exchange", "cadastro");

channel.basicConsume("fila_cadastro", true, deliverCallback, consumerTag -> {});

ğŸ† Boas PrÃ¡ticas com RabbitMQ

| Boas PrÃ¡ticas              | âœ”ï¸ RecomendaÃ§Ãµes                                         |
| -------------------------- | -------------------------------------------------------- |
| Durabilidade das filas     | Use `durable = true` para manter filas apÃ³s restart.     |
| Mensagens persistentes     | Defina mensagens como persistentes se necessÃ¡rio.        |
| Acknowledgment manual      | Para garantir processamento seguro das mensagens.        |
| Dead Letter Exchange (DLX) | Gerenciar mensagens que falharam no processamento.       |
| Monitoramento              | Use RabbitMQ Management Plugin para UI, logs e mÃ©tricas. |


ğŸ“¦ Exemplos de Uso Real RabbitMQ

âœ… Processamento assÃ­ncrono (ex.: geraÃ§Ã£o de PDF, envio de e-mails).
âœ… Pipelines de dados.
âœ… IntegraÃ§Ã£o entre microsserviÃ§os.
âœ… Eventos de domÃ­nio em arquiteturas event-driven.
âœ… Fila de pedidos, pagamentos, notificaÃ§Ãµes.

