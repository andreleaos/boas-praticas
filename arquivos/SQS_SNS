
SQS / SNS

â˜ï¸ O que Ã© AWS SNS?

- SNS (Simple Notification Service) Ã© um serviÃ§o de pub/sub (publicaÃ§Ã£o/assinatura).
- Permite enviar mensagens para mÃºltiplos assinantes, como:

- ğŸ“± E-mails
- ğŸ“² SMS
- ğŸ”¥ HTTP/S endpoints
- ğŸ“¨ SQS queues
- ğŸ”¥ Lambdas

âœ”ï¸ Push-based â†’ Envia a mensagem para os assinantes automaticamente.

---

â˜ï¸ O que Ã© AWS SQS?

- SQS (Simple Queue Service) Ã© um serviÃ§o de fila de mensagens.
- Permite o envio, armazenamento e recebimento de mensagens entre componentes distribuÃ­dos.

- Ã‰ pull-based â†’ O consumidor precisa consultar (poll) para receber mensagens.

---

ğŸ”¥ SNS + SQS â€” Arquitetura Combinada

âœ”ï¸ PadrÃ£o comum em AWS:

Producer â†’ SNS Topic â†’ [SQS Queue 1, SQS Queue 2, Lambda, etc.]
                            â†“                  â†“
                       Consumer 1         Consumer 2

- O Producer publica no SNS Topic.
- O SNS entrega para vÃ¡rias filas SQS (fanout).
- Cada fila SQS Ã© lida por um Consumer independente.

ğŸ¯ Exemplos PrÃ¡ticos em Java

ğŸ”§ DependÃªncias Maven (AWS SDK V2)

<dependency>
    <groupId>software.amazon.awssdk</groupId>
    <artifactId>sns</artifactId>
    <version>2.25.22</version>
</dependency>
<dependency>
    <groupId>software.amazon.awssdk</groupId>
    <artifactId>sqs</artifactId>
    <version>2.25.22</version>
</dependency>


ğŸ—ï¸ Exemplo â€” Publicando no SNS

import software.amazon.awssdk.regions.Region;
import software.amazon.awssdk.services.sns.SnsClient;
import software.amazon.awssdk.services.sns.model.PublishRequest;
import software.amazon.awssdk.services.sns.model.PublishResponse;

public class SnsPublisher {

    public static void main(String[] args) {
        SnsClient snsClient = SnsClient.builder()
                .region(Region.US_EAST_1)
                .build();

        String topicArn = "arn:aws:sns:us-east-1:123456789012:meu-topico-clientes";

        PublishRequest request = PublishRequest.builder()
                .message("Novo cliente cadastrado: AndrÃ© LeÃ£o")
                .topicArn(topicArn)
                .build();

        PublishResponse result = snsClient.publish(request);
        System.out.println("ğŸš€ Mensagem publicada no SNS. ID: " + result.messageId());

        snsClient.close();
    }
}

ğŸ“¨ Exemplo â€” Enviando direto para SQS

import software.amazon.awssdk.regions.Region;
import software.amazon.awssdk.services.sqs.SqsClient;
import software.amazon.awssdk.services.sqs.model.SendMessageRequest;
import software.amazon.awssdk.services.sqs.model.SendMessageResponse;

public class SqsProducer {

    public static void main(String[] args) {
        SqsClient sqsClient = SqsClient.builder()
                .region(Region.US_EAST_1)
                .build();

        String queueUrl = "https://sqs.us-east-1.amazonaws.com/123456789012/minha-fila-clientes";

        SendMessageRequest request = SendMessageRequest.builder()
                .queueUrl(queueUrl)
                .messageBody("Cadastro de cliente: AndrÃ© LeÃ£o")
                .build();

        SendMessageResponse response = sqsClient.sendMessage(request);

        System.out.println("ğŸš€ Mensagem enviada. ID: " + response.messageId());

        sqsClient.close();
    }
}


ğŸ“¥ Exemplo â€” Consumindo da SQS

import software.amazon.awssdk.regions.Region;
import software.amazon.awssdk.services.sqs.SqsClient;
import software.amazon.awssdk.services.sqs.model.Message;
import software.amazon.awssdk.services.sqs.model.ReceiveMessageRequest;
import software.amazon.awssdk.services.sqs.model.DeleteMessageRequest;

import java.util.List;

public class SqsConsumer {

    public static void main(String[] args) {
        SqsClient sqsClient = SqsClient.builder()
                .region(Region.US_EAST_1)
                .build();

        String queueUrl = "https://sqs.us-east-1.amazonaws.com/123456789012/minha-fila-clientes";

        while (true) {
            ReceiveMessageRequest request = ReceiveMessageRequest.builder()
                    .queueUrl(queueUrl)
                    .maxNumberOfMessages(5)
                    .waitTimeSeconds(10) // Long polling
                    .build();

            List<Message> messages = sqsClient.receiveMessage(request).messages();

            for (Message message : messages) {
                System.out.println("ğŸ“¥ Mensagem recebida: " + message.body());

                // Processa e deleta a mensagem
                DeleteMessageRequest deleteRequest = DeleteMessageRequest.builder()
                        .queueUrl(queueUrl)
                        .receiptHandle(message.receiptHandle())
                        .build();

                sqsClient.deleteMessage(deleteRequest);
                System.out.println("ğŸ—‘ï¸ Mensagem deletada da fila.");
            }
        }
    }
}

ğŸ”¥ Funcionamento SNS + SQS Fanout

âœ”ï¸ SNS recebe a publicaÃ§Ã£o.
âœ”ï¸ SNS entrega a mesma mensagem para vÃ¡rias filas SQS.
âœ”ï¸ Cada fila Ã© lida por consumidores independentes e isolados.

âœ… Boas PrÃ¡ticas â€” SNS e SQS

| Item                      | âœ”ï¸ RecomendaÃ§Ãµes                                      |
| ------------------------- | ----------------------------------------------------- |
| Dead Letter Queue (DLQ)   | Configure para tratar mensagens que falharam.         |
| Long Polling (SQS)        | Use `waitTimeSeconds` para reduzir custos e latÃªncia. |
| Visibility Timeout        | Ajuste para evitar processamento duplicado.           |
| Message Retention         | Configure quanto tempo a mensagem fica na fila.       |
| Fila FIFO (se necessÃ¡rio) | Garanta ordem e processamento exatamente uma vez.     |
| Retry + Backoff           | Implemente retries inteligentes no consumer.          |

ğŸ” AutenticaÃ§Ã£o e PermissÃµes

âœ”ï¸ O SDK usa as credenciais configuradas via:

~/.aws/credentials
VariÃ¡veis de ambiente
Roles (EC2, Lambda, ECS, etc.)

âœ”ï¸ PermissÃµes necessÃ¡rias no IAM:

sns:Publish
sqs:SendMessage
sqs:ReceiveMessage
sqs:DeleteMessage

ğŸ—ï¸ Arquitetura Serverless com SNS + SQS + Lambda (opcional)

â†’ SNS (Topic de Clientes)
   â†³ SQS FilaCadastro
   â†³ SQS FilaAtualizacao
   â†³ Lambda para NotificaÃ§Ãµes

ğŸ“¦ Casos de Uso no Mundo Real
ğŸ“¦ Processamento de pedidos.
ğŸ“¢ NotificaÃ§Ãµes assÃ­ncronas (e-mail, SMS, logs).
ğŸ”„ IntegraÃ§Ã£o entre microsserviÃ§os.
ğŸš€ Desacoplamento total entre produtores e consumidores.
ğŸ—ï¸ OrquestraÃ§Ã£o de workflows (fanout ou pipelines).

