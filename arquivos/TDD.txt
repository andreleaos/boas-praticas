TDD

ğŸ—ï¸ O que Ã© TDD?
Test-Driven Development (TDD) Ã© uma prÃ¡tica de desenvolvimento onde vocÃª
escreve os testes antes do cÃ³digo de produÃ§Ã£o.

O fluxo do TDD Ã© baseado no ciclo

ğŸ”„ Ciclo do TDD:

| Fase         | DescriÃ§Ã£o                                                         |
| ------------ | ----------------------------------------------------------------- |
| **Red**      | Escreva um teste que **falha** (o cÃ³digo ainda nÃ£o existe).       |
| **Green**    | Implemente o cÃ³digo **mÃ­nimo necessÃ¡rio para passar o teste**.    |
| **Refactor** | **Refatore** o cÃ³digo mantendo todos os testes verdes (passando). |

ğŸ§  Vantagens do TDD:

- CÃ³digo mais confiÃ¡vel.
- Design orientado a testes â†’ normalmente leva a uma arquitetura melhor e mais desacoplada.
- Facilita manutenÃ§Ã£o e refatoraÃ§Ãµes seguras.
- Reduz bugs e retrabalho.

ğŸ”¥ Exemplo prÃ¡tico de TDD â€” Cadastro de Cliente

ğŸ¯ Passo 1 â€” Red (Teste primeiro)

âœ… Escrever o teste para a regra de negÃ³cio:

"NÃ£o permitir cadastro de cliente com e-mail vazio ou nulo."

package br.com.exemplo.application.usecase;

import br.com.exemplo.domain.entity.Cliente;
import br.com.exemplo.domain.repository.ClienteRepository;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.*;

public class CadastrarClienteUseCaseTest {

    private ClienteRepository repository;
    private CadastrarClienteUseCase useCase;

    @BeforeEach
    void setup() {
        repository = mock(ClienteRepository.class);
        useCase = new CadastrarClienteUseCase(repository);
    }

    @Test
    void naoDeveCadastrarClienteComEmailVazio() {
        Cliente cliente = new Cliente(null, "JoÃ£o", "", "119999999");

        IllegalArgumentException exception = assertThrows(IllegalArgumentException.class, () -> {
            useCase.executar(cliente);
        });

        assertEquals("Email nÃ£o pode ser vazio.", exception.getMessage());
    }
}

âœ”ï¸ Resultado esperado: Teste falha (nÃ£o tem validaÃ§Ã£o ainda).

ğŸ¯ Passo 2 â€” Green (Implementar o cÃ³digo mÃ­nimo)

âœ… Implementar a regra no CadastrarClienteUseCase:

package br.com.exemplo.application.usecase;

import br.com.exemplo.domain.entity.Cliente;
import br.com.exemplo.domain.repository.ClienteRepository;

public class CadastrarClienteUseCase {

    private final ClienteRepository repository;

    public CadastrarClienteUseCase(ClienteRepository repository) {
        this.repository = repository;
    }

    public Cliente executar(Cliente cliente) {
        if (cliente.getEmail() == null || cliente.getEmail().isEmpty()) {
            throw new IllegalArgumentException("Email nÃ£o pode ser vazio.");
        }

        return repository.salvar(cliente);
    }
}

âœ”ï¸ Resultado: Teste passa (verde).

---

ğŸ¯ Passo 3 â€” Refactor (Melhorar sem quebrar)
- Podemos extrair validaÃ§Ãµes, criar uma classe de validaÃ§Ã£o separada, melhorar nomes, simplificar cÃ³digo.

âœ”ï¸ Exemplo simples de refatoraÃ§Ã£o:

private void validarCliente(Cliente cliente) {
    if (cliente.getEmail() == null || cliente.getEmail().isBlank()) {
        throw new IllegalArgumentException("Email nÃ£o pode ser vazio.");
    }
}

E depois usar dentro de executar():

public Cliente executar(Cliente cliente) {
    validarCliente(cliente);
    return repository.salvar(cliente);
}

âœ”ï¸ Roda os testes novamente â†’ Todos continuam verdes.

------

ğŸ”¥ Ciclo TDD â€” Outro exemplo rÃ¡pido

âœ… Teste:

@Test
void deveGerarIdParaClienteSalvo() {
    Cliente cliente = new Cliente(null, "Maria", "maria@email.com", "119999999");

    when(repository.salvar(cliente))
        .thenReturn(new Cliente(1L, "Maria", "maria@email.com", "119999999"));

    Cliente salvo = useCase.executar(cliente);

    assertNotNull(salvo.getId());
    assertEquals(1L, salvo.getId());
}

âœ”ï¸ CÃ³digo mÃ­nimo:

public Cliente executar(Cliente cliente) {
    validarCliente(cliente);
    return repository.salvar(cliente);
}

âœ”ï¸ Repository Mock resolve o ID simulando o comportamento.

ğŸ”¥ Boas PrÃ¡ticas no TDD

| PrÃ¡tica                              | DescriÃ§Ã£o                                  |
| ------------------------------------ | ------------------------------------------ |
| âœ… **Testes pequenos e rÃ¡pidos**      | MantÃ©m o ciclo rÃ¡pido.                     |
| âœ… **Um teste, uma responsabilidade** | Teste deve ter um Ãºnico objetivo.          |
| âœ… **Nomenclatura clara dos testes**  | O nome do mÃ©todo descreve o comportamento. |
| âœ… **Isolamento com Mocks**           | Use Mockito para dependÃªncias externas.    |
| âœ… **Red-Green-Refactor** sempre      | Nunca pule etapas.                         |


ğŸ† Resumo Visual do Fluxo TDD

1. RED â†’ Escreva um teste que falha (sem implementaÃ§Ã£o ainda).
2. GREEN â†’ Escreva o cÃ³digo mÃ­nimo para o teste passar.
3. REFACTOR â†’ Melhore o cÃ³digo mantendo o teste verde.
4. Repita.
